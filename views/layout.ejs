<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aquaflow - Smart Health Surveillance System</title>
    <link rel="icon" type="image/png" href="/images/logo.png">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/components.css">
    <link rel="stylesheet" href="/css/community-post.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* Hide Google Translate banner and branding */
        .goog-te-banner-frame { display: none !important; }
        body { top: 0 !important; }
        .goog-logo-link { display: none !important; }
        .goog-te-gadget { height: 0 !important; overflow: hidden !important; }
    </style>
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo-section">
                    <img width = "100vw" src="/images/logo.png" alt="" srcset="">
                    <div class="logo-text">
                        <h1 class="system-title">Smart Health Surveillance</h1>
                        <p class="system-subtitle">Early Warning System for Water-borne Diseases</p>
                    </div>
                </div>
                
                <div class="header-controls">
                    <div class="language-selector">
                        <i class="fas fa-globe"></i>
                        <select id="languageSelect" onchange="changeLanguage(this.value)">
                            <option value="en" <%= language === 'en' ? 'selected' : '' %>>English</option>
                            <option value="hi" <%= language === 'hi' ? 'selected' : '' %>>हिंदी</option>
                            <option value="as" <%= language === 'as' ? 'selected' : '' %>>অসমীয়া</option>
                            <option value="bn" <%= language === 'bn' ? 'selected' : '' %>>বাংলা</option>
                        </select>
                    </div>
                    <% if (user) { %>
                    <a href="/logout" class="btn-logout" style="margin-left:1rem;display:inline-flex;align-items:center;gap:0.5rem;padding:0.5rem 0.75rem;border:1px solid #d1d5db;border-radius:0.375rem;color:#111827;background:#fff;text-decoration:none;">
                        <i class="fas fa-sign-out-alt"></i>
                        <span>Logout</span>
                    </a>
                    <% } %>
                </div>
            </div>
        </div>
    </header>

    <nav class="navigation">
        <div class="container">
            <div class="nav-items">
                <a href="/dashboard?lang=<%= language %>" class="nav-item <%= activeTab === 'dashboard' ? 'active' : '' %>">
                    <i class="fas fa-chart-bar"></i>
                    <span><%= (user && user.role === 'general') ? 'Home' : 'Dashboard' %></span>
                </a>

                <a href="/outbreak-prediction?lang=<%= language %>" class="nav-item <%= activeTab === 'prediction' ? 'active' : '' %>">
                    <i class="fas fa-biohazard"></i>
                    <span>Outbreak Prediction</span>
                </a>

                <% if (user && user.role === 'general') { %>
                <a href="/report?lang=<%= language %>" class="nav-item <%= activeTab === 'report' ? 'active' : '' %>">
                    <i class="fas fa-file-alt"></i>
                    <span>Community Report</span>
                </a>
                <a href="/education?lang=<%= language %>" class="nav-item <%= activeTab === 'education' ? 'active' : '' %>">
                    <i class="fas fa-graduation-cap"></i>
                    <span>Education</span>
                </a>
                <% } %>

                <% if (user && user.role === 'official') { %>
                <a href="/community-post?lang=<%= language %>" class="nav-item <%= activeTab === 'community-post' ? 'active' : '' %>">
                    <i class="fas fa-newspaper"></i>
                    <span>Community Post</span>
                </a>
                <a href="/water-quality?lang=<%= language %>" class="nav-item <%= activeTab === 'water' ? 'active' : '' %>">
                    <i class="fas fa-tint"></i>
                    <span>Water Quality</span>
                </a>
                <a href="/communications?lang=<%= language %>" class="nav-item <%= activeTab === 'communications' ? 'active' : '' %>">
                    <i class="fas fa-comments"></i>
                    <span>Communications</span>
                </a>
                <% } %>

                <% if (user && user.role === 'master') { %>
                <a href="/community-post?lang=<%= language %>" class="nav-item <%= activeTab === 'community-post' ? 'active' : '' %>">
                    <i class="fas fa-clipboard-list"></i>
                    <span>Manage Posts</span>
                </a>
                <a href="/water-quality?lang=<%= language %>" class="nav-item <%= activeTab === 'water' ? 'active' : '' %>">
                    <i class="fas fa-tint"></i>
                    <span>Water Quality</span>
                </a>
                <a href="/communications?lang=<%= language %>" class="nav-item <%= activeTab === 'communications' ? 'active' : '' %>">
                    <i class="fas fa-comments"></i>
                    <span>Communications</span>
                </a>
                <a href="/admin-management?lang=<%= language %>" class="nav-item <%= activeTab === 'admin-management' ? 'active' : '' %>">
                    <i class="fas fa-user-gear"></i>
                    <span>Admin Management</span>
                </a>
                <% } %>
            </div>
        </div>
    </nav>

    <main class="main-content">
        <div class="container">
            <%- body %>
        </div>
    </main>

    <div id="google_translate_container" style="display:none;"></div>
    <script>
      function googleTranslateElementInit() {
        try {
          new google.translate.TranslateElement({
            pageLanguage: 'en',
            includedLanguages: 'en,hi,bn,as',
            autoDisplay: false
          }, 'google_translate_container');
        } catch (e) {}
      }
    </script>
    <script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

    <div id="alertContainer" class="alert-container"></div>

    <script src="/js/main.js"></script>
    <script src="/js/alerts.js"></script>
    <script>
      // Override changeLanguage to use Google Translate widget (no API key)
      window.changeLanguage = function(language) {
        function applyGoogle() {
          var combo = document.querySelector('select.goog-te-combo');
          if (combo) {
            if (combo.value !== language) {
              combo.value = language;
              combo.dispatchEvent(new Event('change'));
            }
            try { localStorage.setItem('preferredLang', language); } catch(e) {}
            return true;
          }
          return false;
        }
        if (!applyGoogle()) {
          setTimeout(function() {
            if (!applyGoogle()) {
              var currentUrl = new URL(window.location);
              currentUrl.searchParams.set('lang', language);
              window.location.href = currentUrl.toString();
            }
          }, 500);
        }
      };

      document.addEventListener('DOMContentLoaded', function() {
        try {
          var preferred = localStorage.getItem('preferredLang');
          if (preferred && preferred !== 'en') {
            (function tryApply() {
              var combo = document.querySelector('select.goog-te-combo');
              if (combo) {
                if (combo.value !== preferred) {
                  combo.value = preferred;
                  combo.dispatchEvent(new Event('change'));
                }
              } else {
                setTimeout(tryApply, 300);
              }
            })();
          }
        } catch(e) {}
      });
    </script>
    </body>
</html>